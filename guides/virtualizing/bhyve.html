<!doctype html><html lang=en>
<!-- Mirrored from www.haiku-os.org/guides/virtualizing/bhyve by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Aug 2021 01:37:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content><meta name=copyright content="2001-2021 Haiku Inc."><meta property="og:site_name" content="Haiku Project"><meta property="og:title" content="Emulating Haiku in Bhyve"><meta property="og:url" content="bhyve/index.html"><meta property="og:type" content="website"><meta property="og:image" content="../../images/haiku_600x315.png"><title>Emulating Haiku in Bhyve | Haiku Project</title><link rel=canonical href=bhyve/index.html><link rel="shortcut icon" href=../../favicon.ico><link href=../../css/bootstrap.min.css rel=stylesheet><link href=../../css/bootstrap4_fixes.css rel=stylesheet><link href=../../css/shijin4.css rel=stylesheet></head><body><div id=page><a href=../../index.html><img src=../../images/haiku_logo_white.svg alt=Home id=logo height=100 style=padding-left:3px></a><div id=top-links><a href=../../get-haiku/r1beta3/index.html title="Get Haiku!" class=toggleopacity><img src=../../images/download_32.png text="get haiku!" alt=Download></a>
<a href=../../contact.html title="Contact the Haiku Project" class=toggleopacity><img src=../../images/App_Mail_32.png text="contact the haiku project" alt=Contact></a>
<a href=../../community/donating_to_haiku title="Make a donation to the Haiku Project" class=toggleopacity><img src=../../images/App_Finance_32.png alt=Donate text="make a donation to the haiku project"></a>
<a href=https://dev.haiku-os.org/ title="Report bugs" class=toggleopacity><img src=../../images/bug_tracker_32.png alt="Report Bugs" text="report bugs related to haiku"></a>
<a href=https://depot.haiku-os.org/ title="Download apps for Haiku from HaikuDepot" class=toggleopacity><img src=../../images/installer_32.png alt=HaikuDepot text="download apps for haiku from haikudepot"></a></div><nav class="navbar navbar-expand-sm navbar-light bg-light"><button class="navbar-toggler collapsed" id=navbar-toggler type=button data-toggle=collapse data-target=#navbar-collapseme aria-controls=navbar-collapseme aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar-collapseme><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=../../about/index.html>About</a></li><li class=nav-item><a class=nav-link href=../../community/index.html>Community</a></li><li class=nav-item><a class=nav-link href=../../development/index.html>Development</a></li><li class=nav-item><a class=nav-link href=../../documents/index.html>Documents</a></li></ul><form class=form-inline role=search action=https://duckduckgo.com/><input type=hidden name=sites value=https://www.haiku-os.org><div class=input-group><input type=text class=form-control placeholder=Search name=q>
<span class=input-group-append><button type=submit class="btn btn-outline-secondary">&#x1f50d;</button></span></div></form></div></nav><div class=row id=main-front><div class=col-sm-12><ol class=breadcrumb><li class=breadcrumb-item><a href=../../index.html>Home</a></li><li class=breadcrumb-item><a href=../index.html>Haiku Guides</a></li><li class=breadcrumb-item><a href=index.html>Virtualizing Haiku</a></li><li class=breadcrumb-item><a href=bhyve/index.html>Emulating Haiku in Bhyve</a></li></ol></div><div class=col-md-12><div class=node><h1 class=title>Emulating Haiku in Bhyve</h1><p><p>Virtual instances of operating systems are perfect for all kinds of testing purposes that need to be done in a safe and isolated environment. Installing Haiku in a virtual machine is a solution for people who do not want to install it on their physical computers, but wish to become familiar with it.</p><p>In this guide the Haiku operating system is being run under virtual circumstances using FreeBSD and Bhyve.</p><p>Moreover, we will be using an Anyboot image, which can be obtained <a href=../../get-haiku/r1beta3/index.html>here</a>. Both the ISO and anyboot images are available there, do select the closest mirror to enjoy higher transfer rates. Verify using the checksums to make sure that the downloaded files are not corrupted as they are big files.</p><p>This guide assumes that you have installed FreeBSD on your device, you have made some basic configurations to your system and you are currently logged in as a user with root access. The Haiku virtual machine will be installed in UEFI mode.</p><h5 id=go-to-section>Go to section</h5><ul><li><a href=#part_bhyve>Preparing FreeBSD & Bhyve</a></li><li><a href=#part_download>Downloading Haiku</a></li><li><a href=#part_iso>Installing and running Haiku from an Anyboot image</a></li></ul><h3 id=preparing-freebsd--bhyve-a-namepart_bhyvea>Preparing FreeBSD & Bhyve <a name=part_bhyve></a></h3><p><em>Considering that FreeBSD is an operating system that is primarily used in server-based applications that do not rely on a graphical environment, this section was added for beginners that are not used to Unix-like terminals. This process is not much different in FreeBSD than in Linux distributions, so feel free to skip this section if you believe that you are capable of managing the download process yourself.</em></p><p>Before proceeding with the tutorial, you will have to make a few system configurations.</p><h5 id=ca-certificates>CA Certificates</h5><p>Since Haiku images can be fetched securely only via <a href=https://en.wikipedia.org/wiki/HTTPS>HTTPS</a>, you will need to download some <a href=https://en.wikipedia.org/wiki/Certificate_authority>CA root certificates</a>, as FreeBSD does not ship with them by default. In order to do that, you will need to install the <code>security/ca_root_nss</code> package, which is a part of the <a href=https://www.freebsd.org/ports/>FreeBSD ports</a>.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#999;font-style:italic># feel free to skip this process if you have done it before.</span>
portsnap fetch
portsnap extract

<span style=color:#24909d>cd</span> /usr/ports/security/ca_root_nss
make install clean
</code></pre></div><p>Now, follow through the process, and you will be able to fetch the image file securely.</p><h5 id=networking--kernel-preparations>Networking & Kernel Preparations</h5><p>Since <code>bhyve</code> consists of kernel modules that ship with FreeBSD by default, you do not need to install the core part of <code>bhyve</code>.</p><p>However, you will need to load the modules manually in order to use <code>bhyve</code>.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kldload vmm
kldload nmdm
kldload if_bridge
kldload if_tap
</code></pre></div><p>The kernel modules will only remain loaded until you reboot your machine. In order to make the changes permanent, edit <code>/boot/loader.conf</code> by adding:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#999;font-style:italic># Kernel modules</span>
<span style=color:#40ffff>vmm_load</span>=<span style=color:#ed9d13>&#34;YES&#34;</span>
<span style=color:#40ffff>nmdm_load</span>=<span style=color:#ed9d13>&#34;YES&#34;</span>
<span style=color:#40ffff>bridge_load</span>=<span style=color:#ed9d13>&#34;YES&#34;</span>
<span style=color:#40ffff>tap_load</span>=<span style=color:#ed9d13>&#34;YES&#34;</span>
</code></pre></div><p>Now, run the following commands in order to create a network device and a bridge for your virtual machine, in order to make a network bridge (<code>bridge0</code>) that is linked to the virtual device <code>tap0</code>.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sysctl net.link.tap.up_on_open=<span style=color:#3677a9>1</span>
sysctl net.inet.ip.forwarding=<span style=color:#3677a9>1</span>

ifconfig tap0 create
ifconfig bridge0 create

ifconfig bridge0 addm tap0
</code></pre></div><p>But the problem is that the device <code>tap0</code> itself is not linked to any physical, working internet source. This means that even though you may have made the network bridge, you still need to link <code>tap0</code> to a physical network device. In my case, the device that I need to use is <code>re0</code>, but you can find yours by running <code>ifconfig</code>.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>ifconfig bridge0 addm re0
</code></pre></div><p>Lastly, you want to run the following:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>ifconfig bridge0 up
</code></pre></div><p>Now, make your changes permanent by editing <code>/etc/sysctl.conf/</code> and appending the following:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sysctl net.link.tap.up_on_open=<span style=color:#3677a9>1</span>
sysctl net.inet.ip.forwarding=<span style=color:#3677a9>1</span>
</code></pre></div><h3 id=downloading-the-haiku-anyboot-image-a-namepart_downloada>Downloading the Haiku Anyboot image <a name=part_download></a></h3><p>Now that you have made the necessary changes to your system, you can securely obtain a Haiku anyboot image. You will need to install <code>wget</code> to download the image file and you will additionally need the <code>unzip</code> package to extract it, as the image file is packed in a <code>.zip</code> archive together with a <code>ReadMe</code> file.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>pkg install wget unzip
</code></pre></div><p>After installing the two packages, we will fetch the archive containing the anyboot image file and then unzip it. For the purposes of this tutorial, the download of the 64-bit <code>r1beta2</code> from a specific Haiku mirror located in <em>East Coast, Germany</em> will be demonstrated, but if you want to choose a different mirror or a different version, then please consult the website <a href=../../get-haiku/r1beta3/index.html>here</a> and replace the following link accordingly.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>wget https://s3.wasabisys.com/haiku-release/r1beta2/haiku-r1beta2-x86_64-anyboot.zip 
unzip haiku-r1beta2-x86_64-anyboot.zip
</code></pre></div><p>As mentioned earlier, the following files will be extracted in your current working directory:</p><ul><li><code>haiku-release-anyboot.iso</code></li><li><code>ReadMe.md</code></li></ul><p>We will need the <code>haiku-release-anyboot.iso</code> file later, in order to virtualize Haiku.</p><h3 id=installing-and-running-haiku-from-an-anyboot-image-a-namepart_isoa>Installing and running Haiku from an Anyboot image <a name=part_iso></a></h3><p>Now that you have made the required configurations, as well as the networking configurations, you may want to make a new folder in order to keep things clean, and then move your Haiku anyboot image there.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mkdir haiku-vm
mv haiku-release-anyboot.iso haiku-vm
<span style=color:#24909d>cd</span> haiku-vm
</code></pre></div><p>Great! Now that you have a dedicated directory to work on, create a virtual disk for your virtual machine.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#999;font-style:italic># feel free to adjust the number 16G according to your needs</span>
truncate -s 16G haiku-guest.img
</code></pre></div><p>In order to simplify the process, we will use <code>vmrun.sh</code>, an example script which can be found in the <code>/usr/share/examples/bhyve</code> folder.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cp /usr/share/examples/bhyve/vmrun.sh .
sh vmrun.sh -c1 -E -i -I haiku-release-anyboot.iso haiku
</code></pre></div><ul><li><code>-c1</code> stands for the number of processor cores that will be allocated for the machine. In this scenario, we are using 1 core, which is a recommended option.</li><li><code>-E</code> boots the the machine in UEFI mode.</li><li><code>-i</code> forces the boot of the anyboot image.</li><li><code>-I</code> specifies the location of the image file. In this case, since we have placed <code>haiku-release-anyboot.iso</code> in our current working directory, the file name should suffice.</li><li><code>haiku</code> stands for the name of the virtual machine, which can be modified or changed.</li></ul><p>Some additional parameters which could prove to be useful are the following:</p><ul><li><code>-m</code> can change the allocated memory size, which is <code>512M</code> by default.</li><li><code>-v</code> is an option that delays the boot until you connect with a VNC client to the host machine. The default port of the VNC server is <code>5900</code>.</li><li><code>-P</code> allows you to change the port of the VNC server.</li></ul><p>Use the <code>--help</code> parameter if you need additional information.</p><p>Other than that, congratulations! If everything went according to plan, you should now have an internet-connected Haiku virtual machine running on top of Bhyve!</p></p></div></div></div><footer><div style=float:right><a href=https://www.netlify.com/><img src=https://www.netlify.com/img/global/badges/netlify-dark.svg alt="Deploys by Netlify"></a></div><p>&copy; 2001-2021 Haiku, Inc. &mdash; Haiku&reg; and the HAIKU logo&reg; are registered trademarks of <a href=https://www.haiku-inc.org/ target=_blank>Haiku, Inc.</a></p><p class=last><a href=../../index.xml>Main feed</a> |
<a href=../../blog/index.xml>Blog-O-Sphere feed</a> |
<a href=../../community/organization/policies/index.html>Community policies</a> |
<a href=https://twitter.com/haikuOS>Twitter</a> |
<a href=https://mastodon.xyz/@haiku>Mastodon</a> |
<a href=https://www.linkedin.com/company/haiku-inc->LinkedIn</a></p></footer></div><link href="https://fonts.googleapis.com/css?family=Noto+Sans:400,400i,700,700i" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet><script src=../../js/navbar.js></script><!-- Fathom -->
<script>
(function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
})(document, window, '../../../metrics.haiku-os.org/tracker.js', 'fathom');
fathom('trackPageview');
</script>
<!-- / Fathom --></body>
<!-- Mirrored from www.haiku-os.org/guides/virtualizing/bhyve by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Aug 2021 01:37:57 GMT -->
</html>