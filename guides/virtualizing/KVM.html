<!doctype html><html lang=en>
<!-- Mirrored from www.haiku-os.org/guides/virtualizing/KVM by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Aug 2021 01:37:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content><meta name=copyright content="2001-2021 Haiku Inc."><meta property="og:site_name" content="Haiku Project"><meta property="og:title" content="Emulating Haiku in KVM"><meta property="og:url" content="kvm/index.html"><meta property="og:type" content="website"><meta property="og:image" content="../../images/haiku_600x315.png"><title>Emulating Haiku in KVM | Haiku Project</title><link rel=canonical href=kvm/index.html><link rel="shortcut icon" href=../../favicon.ico><link href=../../css/bootstrap.min.css rel=stylesheet><link href=../../css/bootstrap4_fixes.css rel=stylesheet><link href=../../css/shijin4.css rel=stylesheet></head><body><div id=page><a href=../../index.html><img src=../../images/haiku_logo_white.svg alt=Home id=logo height=100 style=padding-left:3px></a><div id=top-links><a href=../../get-haiku/r1beta3/index.html title="Get Haiku!" class=toggleopacity><img src=../../images/download_32.png text="get haiku!" alt=Download></a>
<a href=../../contact.html title="Contact the Haiku Project" class=toggleopacity><img src=../../images/App_Mail_32.png text="contact the haiku project" alt=Contact></a>
<a href=../../community/donating_to_haiku title="Make a donation to the Haiku Project" class=toggleopacity><img src=../../images/App_Finance_32.png alt=Donate text="make a donation to the haiku project"></a>
<a href=https://dev.haiku-os.org/ title="Report bugs" class=toggleopacity><img src=../../images/bug_tracker_32.png alt="Report Bugs" text="report bugs related to haiku"></a>
<a href=https://depot.haiku-os.org/ title="Download apps for Haiku from HaikuDepot" class=toggleopacity><img src=../../images/installer_32.png alt=HaikuDepot text="download apps for haiku from haikudepot"></a></div><nav class="navbar navbar-expand-sm navbar-light bg-light"><button class="navbar-toggler collapsed" id=navbar-toggler type=button data-toggle=collapse data-target=#navbar-collapseme aria-controls=navbar-collapseme aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar-collapseme><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=../../about/index.html>About</a></li><li class=nav-item><a class=nav-link href=../../community/index.html>Community</a></li><li class=nav-item><a class=nav-link href=../../development/index.html>Development</a></li><li class=nav-item><a class=nav-link href=../../documents/index.html>Documents</a></li></ul><form class=form-inline role=search action=https://duckduckgo.com/><input type=hidden name=sites value=https://www.haiku-os.org><div class=input-group><input type=text class=form-control placeholder=Search name=q>
<span class=input-group-append><button type=submit class="btn btn-outline-secondary">&#x1f50d;</button></span></div></form></div></nav><div class=row id=main-front><div class=col-sm-12><ol class=breadcrumb><li class=breadcrumb-item><a href=../../index.html>Home</a></li><li class=breadcrumb-item><a href=../index.html>Haiku Guides</a></li><li class=breadcrumb-item><a href=index.html>Virtualizing Haiku</a></li><li class=breadcrumb-item><a href=kvm/index.html>Emulating Haiku in KVM</a></li></ol></div><div class=col-md-12><div class=node><h1 class=title>Emulating Haiku in KVM</h1><p><p>For Google Code-In 2019, Vrondir created a <a href=http://haiku-files.org/files/media/GCI-2019_KVM_Vrondir.mp4>video on how to install Haiku in KVM</a> [79 MiB].</p><p>Virtual instances of operating systems are perfect for all kinds of testing purposes that need to be done in a safe and isolated environment. Therefore, installing Haiku in a virtual machine is an ideal solution for people who do not want to install it on their physical computers but want to become familiar with it.</p><p>This guide was tested extensively in a <a href=https://manjaro.org/>Manjaro Linux</a> installation, but it should work on any distribution of Linux that can run KVM.</p><p>In this guide, we will be using a <strong>nightly</strong> <code>anyboot</code> image because nightlies contain the latest Haiku changes - it can be obtained <a href=https://download.haiku-os.org/>here</a>. We recommend using the <a href=../../get-haiku/r1beta3/index.html>official release of Haiku</a> for stability.</p><h5 id=go-to-section>Go to section</h5><ul><li><a href=#part_kvm>Installing KVM</a></li><li><a href=#part_iso>Installing and running Haiku from an anyboot image</a></li><li><a href=#part_trouble>Troubleshooting</a></li></ul><h3 id=installing-kvm-a-namepart_kvma>Installing KVM <a name=part_kvm></a></h3><h4 id=ubuntu-linuxdebian>Ubuntu Linux/Debian</h4><p>If you are using Ubuntu or generally more traditional Debian-based Linux distributions, you will need to run the following commands:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo apt-get update &amp;&amp; sudo apt-get upgrade
sudo apt-get install qemu-kvm libvirt-daemon-system libvirt-clients virt-manager
</code></pre></div><p>In older versions (Ubuntu 18.04, Debian Stretch or older), you will need to run these commands instead:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo apt-get update &amp;&amp; sudo apt-get upgrade
sudo apt-get install qemu-kvm libvirt-bin virt-manager
</code></pre></div><p>To start <code>libvirtd</code> at boot, enter the following command in the terminal:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo systemctl <span style=color:#24909d>enable</span> --now libvirtd
</code></pre></div><h4 id=arch-linux>Arch Linux</h4><p>If you are using Arch Linux, you should enter the following commands in the terminal:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo pacman -Syu qemu virt-manager
</code></pre></div><p>Make sure to enable <code>libvirtd</code>, which is not enabled by default:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo systemctl <span style=color:#24909d>enable</span> --now libvirtd
</code></pre></div><h3 id=installing-and-running-haiku-from-an-anyboot-image-a-namepart_isoa>Installing and running Haiku from an anyboot image <a name=part_iso></a></h3><p>Once the archive with the anyboot image is downloaded and unpacked, you can start the installation.</p><p>First, create a new virtual machine.</p><p><img src=../../files/guides/virtualizing/kvm/virt_machine_manager2.png alt=virt_machine_manager2></p><p>Secondly, choose the method of OS installation, which should be <strong><code>Local install media</code></strong> in our case. Then, click <strong><code>Forward</code></strong></p><p><img src=../../files/guides/virtualizing/kvm/step_one.png alt=step_one></p><p>Find the <strong><code>anyboot</code></strong> image you have decompressed and select the operating system you are installing. <code>virt-manager</code> can detect the operating system you&rsquo;re attempting to install. Although virt-manager can detect the operating system you&rsquo;re attempting to install under normal circumstances, it may be unable to do so. In that case, just uncheck the <strong><code>Automatically detect</code></strong> checkbox and just type in the OS name. Then, click <strong><code>Forward</code></strong></p><p><img src=https://www.haiku-os.org/files/guides/virtualizing/kvm/step_two.png alt=step_two></p><p>You can now choose the memory and CPU settings. What you should select here, depends on the system you have. It is better to assign more than 256MiB of RAM for smooth running; too much, on the other hand, may cause a lag for the host. Once again, after choosing your desired memory size and CPU, click <strong><code>Forward</code></strong></p><p><img src=https://www.haiku-os.org/files/guides/virtualizing/kvm/step_three.png alt=step_three></p><p>You can also adjust the size of the disk image. When done, click <strong><code>Forward</code></strong></p><p><img src=https://www.haiku-os.org/files/guides/virtualizing/kvm/step_four.png alt=step_four></p><p>Name the virtual machine, verify the settings of your virtual machine, click <strong><code>Finish</code></strong></p><p><img src=https://www.haiku-os.org/files/guides/virtualizing/kvm/step_five.png alt=step_five></p><p>A popup saying <code>Virtual Network is not active</code> may appear. Don&rsquo;t worry, it&rsquo;s just asking you to enable the <code>'default'</code> network. Just click <code>Yes</code> and everything should be fine. If this goes wrong, consult the <a href=#part_trouble>Troubleshooting section</a>.
The VM will now boot the Haiku image file. You can choose to install Haiku or boot to the desktop. Installation is simple and does not differ significantly from a physical one (follow the guides <a href=https://www.haiku-os.org/get-haiku/installation-guide>on this page</a> if you are not familiar with the installation process).</p><h3 id=troubleshooting-a-namepart_troublea>Troubleshooting <a name=part_trouble></a></h3><p>After finishing the installation of your VM, if you run into an error that says <strong><code>Unable to complete install: network default is not active</code></strong> or something along those lines, make sure that <code>libvirtd</code> is running by entering <code>sudo systemctl start libvirtd</code> in terminal.
If the error still occurs do the following steps:</p><h5 id=step-1-check-if-you-have-a-defined-network-by-running-a-namepart_trouble_1a>Step 1. Check if you have a defined network by running: <a name=part_trouble_1></a></h5><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo virsh net-list --all
</code></pre></div><ul><li>If you don&rsquo;t have a defined network, the output will look like this:</li></ul><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Name                 State      Autostart     Persistent
----------------------------------------------------------
</code></pre></div><ul><li>If you do have a defined network, the output will look like this:</li></ul><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh> Name      State      Autostart   Persistent
----------------------------------------------
 default   inactive   no          yes
</code></pre></div><p>Skip to <strong><a href=#part_trouble_3>Step 3</a></strong> if your output does look like this.</p><h5 id=step-2-define-the-default-network-by-copy-pasting-the-following-lines-into-a-file-called-defaultxml-a-namepart_trouble_2a>Step 2. Define the <code>'default'</code> network by copy-pasting the following lines into a file called <code>default.xml</code>: <a name=part_trouble_2></a></h5><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>&lt;network&gt;
  &lt;name&gt;default&lt;/name&gt;
  &lt;uuid&gt;9a05da11-e96b-47f3-8253-a3a482e445f5&lt;/uuid&gt;
  &lt;forward <span style=color:#40ffff>mode</span>=<span style=color:#ed9d13>&#39;nat&#39;</span>/&gt;
  &lt;bridge <span style=color:#40ffff>name</span>=<span style=color:#ed9d13>&#39;virbr0&#39;</span> <span style=color:#40ffff>stp</span>=<span style=color:#ed9d13>&#39;on&#39;</span> <span style=color:#40ffff>delay</span>=<span style=color:#ed9d13>&#39;0&#39;</span>/&gt;
  &lt;mac <span style=color:#40ffff>address</span>=<span style=color:#ed9d13>&#39;52:54:00:0a:cd:21&#39;</span>/&gt;
  &lt;ip <span style=color:#40ffff>address</span>=<span style=color:#ed9d13>&#39;192.168.122.1&#39;</span> <span style=color:#40ffff>netmask</span>=<span style=color:#ed9d13>&#39;255.255.255.0&#39;</span>&gt;
    &lt;dhcp&gt;
      &lt;range <span style=color:#40ffff>start</span>=<span style=color:#ed9d13>&#39;192.168.122.2&#39;</span> <span style=color:#40ffff>end</span>=<span style=color:#ed9d13>&#39;192.168.122.254&#39;</span>/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;
</code></pre></div><p>Run the following to add that network permanently to the KVM host:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo virsh net-define --file default.xml
</code></pre></div><h5 id=step-3-to-manually-start-the-network-run-a-namepart_trouble_3a>Step 3. To manually start the network, run: <a name=part_trouble_3></a></h5><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo virsh net-start default
</code></pre></div><h6 id=troubleshooting>Troubleshooting</h6><p>There&rsquo;s a chance that you may receive the following error when you run the aforementioned command:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ sudo virsh net-start default
error: Failed to start network default
error: internal error: Failed to initialize a valid firewall backend
</code></pre></div><p>To fix that, you will need to install <strong><code>firewalld</code></strong>.</p><p>After installing the package, run the following commands to enable the service and make networking work again:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo systemctl <span style=color:#24909d>enable</span> --now firewalld
sudo systemctl restart libvirtd
</code></pre></div><h6 id=autostart>Autostart</h6><p>If you want your virtual network to start automatically in the future, run the following command:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo virsh net-autostart --network default
</code></pre></div><p>Running <strong><code>sudo virsh net-list -all</code></strong> should now return the following:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh> Name      State      Autostart   Persistent
----------------------------------------------
 default   inactive   yes         yes
</code></pre></div></p></div></div></div><footer><div style=float:right><a href=https://www.netlify.com/><img src=https://www.netlify.com/img/global/badges/netlify-dark.svg alt="Deploys by Netlify"></a></div><p>&copy; 2001-2021 Haiku, Inc. &mdash; Haiku&reg; and the HAIKU logo&reg; are registered trademarks of <a href=https://www.haiku-inc.org/ target=_blank>Haiku, Inc.</a></p><p class=last><a href=https://www.haiku-os.org/index.xml>Main feed</a> |
<a href=https://www.haiku-os.org/blog/index.xml>Blog-O-Sphere feed</a> |
<a href=https://www.haiku-os.org/community/organization/policies/>Community policies</a> |
<a href=https://twitter.com/haikuOS>Twitter</a> |
<a href=https://mastodon.xyz/@haiku>Mastodon</a> |
<a href=https://www.linkedin.com/company/haiku-inc->LinkedIn</a></p></footer></div><link href="https://fonts.googleapis.com/css?family=Noto+Sans:400,400i,700,700i" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet><script src=https://www.haiku-os.org/js/navbar.js></script><!-- Fathom -->
<script>
(function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
})(document, window, 'https://metrics.haiku-os.org/tracker.js', 'fathom');
fathom('trackPageview');
</script>
<!-- / Fathom --></body>
<!-- Mirrored from www.haiku-os.org/guides/virtualizing/KVM by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 05 Aug 2021 01:37:55 GMT -->
</html>